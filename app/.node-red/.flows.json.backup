[{"id":"137a9152.2c26cf","type":"tab","label":"Assets","disabled":false,"info":""},{"id":"b7b775e0.9589b8","type":"tab","label":"Employees","disabled":false,"info":""},{"id":"3c1f6dd2.c28162","type":"tab","label":"Backup","disabled":true,"info":""},{"id":"6b628289.79f0ac","type":"subflow","name":"humanity","info":"","in":[{"x":72.00000381469727,"y":68.00000381469727,"wires":[{"id":"a2287ef.3c7478"}]}],"out":[]},{"id":"48984b9c.f764e4","type":"mqtt-broker","z":"","name":"rabbit","broker":"white-swan.rmq.cloudamqp.com","port":"1883","tls":"","clientid":"","usetls":true,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"8de3c01b.03c44","type":"mqtt-broker","broker":"10.0.1.10","port":"1883"},{"id":"9b5a5bab.b045b8","type":"git-nodes-config","z":"","name":"github opol6","git":"git@github.com:adowning/opol6.git"},{"id":"8c5fc8f9.567368","type":"json-db-collection","z":"","name":"assets","collection":"assets","save":true},{"id":"a653adb3.e0809","type":"mqtt-broker","z":"","name":"rabbit","broker":"white-swan.rmq.cloudamqp.com","port":"1883","tls":"","clientid":"","usetls":true,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"351736bb.017b9a","type":"cloudantplus","z":"","host":"938d6de2-a827-4db5-9031-ec0143d91b2b-bluemix.cloudant.com","name":"bluemix_opol6"},{"id":"d7812501.91ffc8","type":"ibmiot","z":"3c1f6dd2.c28162","name":"","keepalive":"60","serverName":"","cleansession":true,"appId":"","shared":false},{"id":"bac7517a.0b476","type":"ibmiot","z":"","name":"opol6-iot-connection","keepalive":"60","serverName":"opol6-iot","cleansession":true,"appId":"","shared":false},{"id":"a2287ef.3c7478","type":"function","z":"6b628289.79f0ac","name":"","func":"msg.headers = {}\nlet config = {\n   client_id: '1de720f9636d0f17d61540fbd9c030c30fae3f1f',\n   client_secret: '33c1bfc4f96d5ca7e68b859af8d58fde36867bbd',\n   grant_type: 'password',\n   username: 'ash@andrewscarpetcleaning.com',\n   password: 'sugarlips42'\n}\nmsg.headers[\"content-type\"] = 'application/x-www-form-urlencoded' //should be set to application/x-www-form-urlencoded.\nmsg.payload = config\nmsg.redirect = false\nconsole.log(msg)\nreturn msg;\n\n// url string\n// If not configured in the node, this optional property sets the url of the request.\n// method string\n// If not configured in the node, this optional property sets the HTTP method of the request. Must be one of GET, PUT, POST, PATCH or DELETE.\n// headers object\n// Sets the HTTP headers of the request.\n// cookies object\n// If set, can be used to send cookies with the request.\n// payload\n// Sent as the body of the request.\n// rejectUnauthorized\n// If set to false, allows requests to be made to https sites that use self signed certificates.\n// followRedirects","outputs":1,"noerr":0,"x":207.18058395385742,"y":66.65971374511719,"wires":[["e8bf1739.737218"]]},{"id":"e8bf1739.737218","type":"http request","z":"6b628289.79f0ac","name":"","method":"POST","ret":"txt","url":"https://www.humanity.com/oauth2/token.php","tls":"","x":372.1875915527344,"y":67.7152910232544,"wires":[["113e2666.ace95a","f7cd729f.4f457"]]},{"id":"113e2666.ace95a","type":"function","z":"6b628289.79f0ac","name":"","func":"console.log(msg)\nconst _token = JSON.parse(msg.payload)\nconst humanity = {\n    token: _token['access_token']\n}\nglobal.set('humanity', humanity)\nmsg.token = humanity.token\nconsole.log(global.get('humanity').token)\n\nreturn msg;","outputs":1,"noerr":0,"x":531.1805391311646,"y":67.55556869506836,"wires":[[]]},{"id":"f7cd729f.4f457","type":"debug","z":"6b628289.79f0ac","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":534.1944732666016,"y":106.52083587646484,"wires":[]},{"id":"6edfa716.7635e8","type":"http request","z":"6b628289.79f0ac","name":"","method":"GET","ret":"txt","url":"https://www.humanity.com/api/v2/companies/135324?access_token={{{token}}}","tls":"","x":118.18056106567383,"y":157.7187442779541,"wires":[["cd23e99a.170058"]]},{"id":"cd23e99a.170058","type":"function","z":"6b628289.79f0ac","name":"","func":"const staff = JSON.parse(msg.payload).staff\nglobal.set('humanity_staff', staff)\nreturn msg;","outputs":1,"noerr":0,"x":286.1909942626953,"y":157.44098663330078,"wires":[[]]},{"id":"a7e2e21.75bd32","type":"http in","z":"137a9152.2c26cf","name":"","url":"/api/getprofiles","method":"get","upload":false,"swaggerDoc":"","x":190,"y":100,"wires":[["5e2315e2.c43aac"]]},{"id":"4ecfc698.bddf38","type":"http response","z":"137a9152.2c26cf","name":"return profiles","statusCode":"","headers":{},"x":680,"y":100,"wires":[]},{"id":"dc6676d8.928138","type":"http in","z":"137a9152.2c26cf","name":"","url":"/api/putconsumables","method":"get","upload":false,"swaggerDoc":"","x":210,"y":280,"wires":[["f4196a75.2752f8","32e67139.a6b29e"]]},{"id":"32e67139.a6b29e","type":"http response","z":"137a9152.2c26cf","name":"consumables inserted","statusCode":"","headers":{},"x":700,"y":280,"wires":[]},{"id":"f9f782be.a941","type":"http in","z":"137a9152.2c26cf","name":"","url":"/api/getconsumables","method":"get","upload":false,"swaggerDoc":"","x":200,"y":340,"wires":[["bdbfe635.229218"]]},{"id":"3731311d.19392e","type":"http response","z":"137a9152.2c26cf","name":"return consumables","statusCode":"","headers":{},"x":680,"y":340,"wires":[]},{"id":"199916a0.8bd4c9","type":"http response","z":"137a9152.2c26cf","name":"owntracks inserted","statusCode":"","headers":{},"x":710,"y":800,"wires":[]},{"id":"1cac6ae5.9de2d5","type":"http in","z":"137a9152.2c26cf","name":"","url":"/api/assets/checkouthardware","method":"get","upload":false,"swaggerDoc":"","x":1070,"y":140,"wires":[["f3dd73a2.0a9df"]]},{"id":"6a1f7f6.714dc8","type":"http in","z":"137a9152.2c26cf","name":"","url":"/api/assets/checkinhardware","method":"get","upload":false,"swaggerDoc":"","x":1020,"y":200,"wires":[["72a74ae4.7c59f4"]]},{"id":"f3dd73a2.0a9df","type":"function","z":"137a9152.2c26cf","name":"ash","func":"msg.headers = {}\nvar msg2 = msg \nconst token = global.get('snipeit_token')\nmsg.headers['Accept'] = 'application/json'\nmsg.headers[\"Authorization\"] = 'Bearer '+ token\nmsg.redirect = false\nmsg.assetId = msg.payload.assetId\nmsg.username = msg.payload.username\nnode.warn(msg.username)\nmsg.snipeit_host = global.get('snipeit_host')\nmsg2 = msg.payload = global.get('profiles')\n\nreturn [msg, msg2]","outputs":1,"noerr":0,"x":1270,"y":140,"wires":[["323628cd.2feb18"]]},{"id":"d6cc561c.237cf8","type":"http response","z":"137a9152.2c26cf","name":"","statusCode":"","headers":{},"x":1830,"y":140,"wires":[]},{"id":"72a74ae4.7c59f4","type":"function","z":"137a9152.2c26cf","name":"ash","func":"msg.headers = {}\nconst token = global.get('snipeit_token')\nmsg.headers['Accept'] = 'application/json'\nmsg.headers[\"Authorization\"] = 'Bearer '+ token\nmsg.redirect = false\nconsole.log(msg.payload.assetId)\nmsg.id = msg.payload.assetId\nmsg.snipeit_host = global.get('snipeit_host')\n\n console.log(msg.id)\nreturn msg;","outputs":1,"noerr":0,"x":1220,"y":200,"wires":[["fe6aef68.7a71e"]]},{"id":"5862cc7a.812034","type":"http request","z":"137a9152.2c26cf","name":"","method":"GET","ret":"txt","url":"{{{snipeit_host}}}/hardware/{{{assetId}}}/checkout?assigned_user={{{userId}}}&checkout_to_type=user","tls":"","x":1670,"y":140,"wires":[["d6cc561c.237cf8","a629a1a2.5dcee","57ac82f3.385e7c"]]},{"id":"eb54e1ff.d5122","type":"function","z":"137a9152.2c26cf","name":"ash","func":"msg.headers = {}\nconst token = global.get('snipeit_token')\nmsg.headers['Accept'] = 'application/json'\nmsg.headers[\"Authorization\"] = 'Bearer '+ token\nmsg.redirect = false\nmsg.snipeit_host = global.get('snipeit_host')\nmsg.mock = false\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":280,"wires":[["17d55713.6066a9"]]},{"id":"17d55713.6066a9","type":"http request","z":"137a9152.2c26cf","name":"","method":"GET","ret":"txt","url":"{{{snipeit_host}}}/hardware","tls":"","x":1370,"y":280,"wires":[["50a36340.524b8c"]]},{"id":"51286b7.bdc3594","type":"function","z":"137a9152.2c26cf","name":"set snipeit shit","func":"global.set('snipeit_token', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjQ0ODQ5ZmVjYmQ3YTBiNWUxMjg4MzUzMjZkZjdkNDM0ZjA1YjVmNWVmZjM0MWQ3NTVjM2NmMGVhODIxODNjNjAyNWQ4NWE4OTE2ZWNiMjlmIn0.eyJhdWQiOiIxIiwianRpIjoiNDQ4NDlmZWNiZDdhMGI1ZTEyODgzNTMyNmRmN2Q0MzRmMDViNWY1ZWZmMzQxZDc1NWMzY2YwZWE4MjE4M2M2MDI1ZDg1YTg5MTZlY2IyOWYiLCJpYXQiOjE1MjgzMDkyMDgsIm5iZiI6MTUyODMwOTIwOCwiZXhwIjoxNTU5ODQ1MjA4LCJzdWIiOiIxIiwic2NvcGVzIjpbXX0.yv1QL0Vbf4EupDdI-9U6somSbALryrk5UXX5cMV_iNILSye7rKqruoLurDghzt6-2PboAHffoiWnBGRp36vdJ5oUTNKWPSYl-PQqLkDVWjinpcQ0jHZM75lLausxkIknDi4bFlXPgWHtewotLUQKdDW-Nkij6EckVUZbn2lOFw2bi2HOGzENVl7H8VHaBXlQw_cBpT7w4K1FaHkYE2qECK-B2GZ0VlVw3sBDESbyT0sb-HRzt-6R1icItzMHUXz0sbJox3LyfGJ3X4Z3-_tKk3mxd9TXldWf7HTdk5d65r9YBCl770Ha1rAKhwyGGvMU6jBfQemGcklzooivRfVjzhRD5BlpJNqus7NquyEYacPdmm7A4Tp3bbzyxNeh_7jlVjqsf7CrWy78nFUdrrtE6gBavMwAz8AE7FScH6NzMjCekTU-pvEuUjEmTwj5p_NCUt8Yjwo9u66UzlgVf45wsG3qngL50D097rTzdA97-XGlt-csbZ_m7v2lJXNjR0yxM29aNFQBnui7RLd0_mAtoP41WtXMNlsLL9uaD3wK2tpcpoZViRWPYeg9gs81goMTzQ0ct370urdwkuNwNMvX5N1yljJIShgXnk75EP6YscOdmvR5FrlLm_5b07k7Ywwd9ZfbuaT9RI6YeUruSlH6-fGeH3Q37Gui1i4QSU5M5uc')\nglobal.set('snipeit_host', 'http://52.39.121.124:8080/api/v1')\n\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1300,"y":360,"wires":[["f94f9839.a060d8"]]},{"id":"774b9fc.1a7016","type":"function","z":"137a9152.2c26cf","name":"ash","func":"global.set('profiles', JSON.parse(msg.payload))\n\nreturn msg;","outputs":1,"noerr":0,"x":1690,"y":360,"wires":[[]]},{"id":"f94f9839.a060d8","type":"http request","z":"137a9152.2c26cf","name":"","method":"GET","ret":"txt","url":"https://opol.mybluemix.net/getdata","tls":"","x":1530,"y":360,"wires":[["774b9fc.1a7016"]]},{"id":"aa3f18f1.8c5668","type":"inject","z":"137a9152.2c26cf","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":1110,"y":360,"wires":[["51286b7.bdc3594"]]},{"id":"50a36340.524b8c","type":"http response","z":"137a9152.2c26cf","name":"","statusCode":"","headers":{},"x":1530,"y":280,"wires":[]},{"id":"f8621d21.edcfd","type":"http in","z":"137a9152.2c26cf","name":"","url":"/api/assets/hardwarelist","method":"get","upload":false,"swaggerDoc":"","x":1040,"y":280,"wires":[["eb54e1ff.d5122"]]},{"id":"fe6aef68.7a71e","type":"http request","z":"137a9152.2c26cf","name":"","method":"GET","ret":"txt","url":"{{{snipeit_host}}}/hardware/{{{id}}}/checkin","tls":"","x":1370,"y":200,"wires":[["fdcf340a.5647f8"]]},{"id":"fdcf340a.5647f8","type":"http response","z":"137a9152.2c26cf","name":"","statusCode":"","headers":{},"x":1530,"y":200,"wires":[]},{"id":"458b8570.4854ec","type":"function","z":"137a9152.2c26cf","name":"","func":"// msg.assetId = msg.payload[0].assetId\n// msg.userId = msg.payload.userId\nmsg.userId = msg.payload.snipeitId\nnode.warn(msg.userId)\n\nreturn msg;","outputs":1,"noerr":0,"x":1530,"y":140,"wires":[["5862cc7a.812034"]]},{"id":"323628cd.2feb18","type":"filter","z":"137a9152.2c26cf","name":"","property":"msg2.payload.username","propertyType":"flow","asArray":false,"itemProperty":"payload","itemPropertyType":"item","rules":[{"t":"eq","v":"msg2.username","vt":"flow","output":1}],"checkall":"true","outputs":1,"x":1410,"y":140,"wires":[["458b8570.4854ec"]]},{"id":"57ac82f3.385e7c","type":"debug","z":"137a9152.2c26cf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1850,"y":200,"wires":[]},{"id":"466d2c46.c30434","type":"function","z":"137a9152.2c26cf","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1830,"y":80,"wires":[[]]},{"id":"8341fedb.9c6ca","type":"inject","z":"137a9152.2c26cf","name":"","topic":"","payload":"{\"assetId\":\"1\", \"username\":\"ash\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1130,"y":100,"wires":[["f3dd73a2.0a9df"]]},{"id":"7128c66.6211738","type":"debug","z":"137a9152.2c26cf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":340,"y":800,"wires":[]},{"id":"7e759bed.d97314","type":"ibmiot in","z":"137a9152.2c26cf","authentication":"apiKey","apiKey":"bac7517a.0b476","inputType":"evt","logicalInterface":"","ruleId":"","deviceId":"","applicationId":"","deviceType":"+Tablets","eventType":"+locationUpdate","commandType":"","format":"json","name":"IBM IoT - locationUpdates","service":"registered","allDevices":true,"allApplications":"","allDeviceTypes":"","allLogicalInterfaces":"","allEvents":"","allCommands":"","allFormats":"","qos":0,"x":230,"y":800,"wires":[["7128c66.6211738","c564a6c0.8c9b98"]]},{"id":"a629a1a2.5dcee","type":"DataIn","z":"137a9152.2c26cf","collection":"8c5fc8f9.567368","name":"checkoutlist","update":false,"path":"/assets/checkoutlist","x":1970,"y":100,"wires":[]},{"id":"d08cff8d.a9ed1","type":"DataOut","z":"137a9152.2c26cf","collection":"8c5fc8f9.567368","name":"ashdowning@gmail.com","path":"/","error":false,"x":1570,"y":40,"wires":[[]]},{"id":"f4196a75.2752f8","type":"cloudantplus out","z":"137a9152.2c26cf","name":"insert consumables","cloudant":"351736bb.017b9a","database":"consumables","service":"_ext_","payonly":true,"operation":"insert","x":430,"y":260,"wires":[]},{"id":"c564a6c0.8c9b98","type":"cloudantplus out","z":"137a9152.2c26cf","name":"insert owntracks","cloudant":"351736bb.017b9a","database":"owntracks","service":"_ext_","payonly":true,"operation":"insert","x":350,"y":760,"wires":[]},{"id":"5e2315e2.c43aac","type":"cloudantplus in","z":"137a9152.2c26cf","name":"Retrieve profiles","cloudant":"351736bb.017b9a","database":"profiles","service":"_ext_","search":"_id_","design":"","index":"","x":420,"y":100,"wires":[["4ecfc698.bddf38"]]},{"id":"bdbfe635.229218","type":"cloudantplus in","z":"137a9152.2c26cf","name":"Retrieve consumables","cloudant":"351736bb.017b9a","database":"consumables","service":"_ext_","search":"_id_","design":"","index":"","x":430,"y":340,"wires":[["3731311d.19392e"]]},{"id":"b3813c56.83b8f","type":"http response","z":"137a9152.2c26cf","name":"owntracks inserted","statusCode":"","headers":{},"x":690,"y":640,"wires":[]},{"id":"43afc6a6.9ea7f8","type":"http in","z":"137a9152.2c26cf","name":"","url":"/api/getowntracks","method":"get","upload":false,"swaggerDoc":"","x":200,"y":700,"wires":[["73f9ddf6.21da44"]]},{"id":"b82731a7.411cb","type":"http response","z":"137a9152.2c26cf","name":"return owntracks","statusCode":"","headers":{},"x":680,"y":700,"wires":[]},{"id":"5d0c8950.3667f8","type":"cloudantplus out","z":"137a9152.2c26cf","name":"insert owntracks","cloudant":"351736bb.017b9a","database":"owntracks","service":"_ext_","payonly":true,"operation":"insert","x":440,"y":640,"wires":[]},{"id":"73f9ddf6.21da44","type":"cloudantplus in","z":"137a9152.2c26cf","name":"Retrieve owntracks","cloudant":"351736bb.017b9a","database":"owntracks","service":"_ext_","search":"_id_","design":"","index":"","x":430,"y":700,"wires":[["b82731a7.411cb"]]},{"id":"61e409a6.a22e28","type":"debug","z":"137a9152.2c26cf","name":"","active":false,"complete":false,"x":570,"y":800,"wires":[]},{"id":"3627dd79.9a4072","type":"function","z":"137a9152.2c26cf","name":"ash2","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\nvar now = Date();\nvar message = \"\";\ndata = JSON.parse(msg.payload);\n\nif ( (data._type == \"location\") && (data.event != undefined ) ) {\n\t\n\t\tif ( data.event == \"enter\" ) {\t\t\t\n\t\t\tmessage = \"Entering Location: \";\n\t\t} else {\n\t\t\tmessage = \"Leaving Location: \";\n\t\t}\n\t\t\n\t\tif ( data.desc != undefined ) {\n\t\t\t// Shared waypoint, comes with a description:\n\t\t\t\tmessage += data.desc;\n \t\t} else {\n \t\t\t// No description is set, non shared \"private\" waypoint\n \t\t\t\tmessage += data.lat + \",\" + data.lon;\n \t\t}\n }\n\nmsg.payload = message;\n//console.log(msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":411,"y":925,"wires":[["29cd98a0.0f0ac8","712d8cfa.522a84"]]},{"id":"29cd98a0.0f0ac8","type":"switch","z":"137a9152.2c26cf","name":"","property":"payload","rules":[{"t":"cont","v":"Location"}],"checkall":"true","outputs":1,"x":572,"y":925,"wires":[[]]},{"id":"712d8cfa.522a84","type":"debug","z":"137a9152.2c26cf","name":"","active":true,"complete":false,"x":571,"y":853,"wires":[]},{"id":"cd4062f7.1066c","type":"inject","z":"137a9152.2c26cf","name":"Test Shared Waypoint","topic":"","payload":"{\"_type\": \"location\", \"lat\": \"xxxx\", \"lon\": \"yyyy\", \"tst\": \"1391715492\", \"acc\": \"500.0\", \"batt\": \"48\", \"desc\": \"Shared Test Waypoint\", \"event\": \"enter\"}","payloadType":"string","repeat":"","crontab":"","once":false,"x":216,"y":925,"wires":[["3627dd79.9a4072"]]},{"id":"d24f02d6.80cf3","type":"inject","z":"137a9152.2c26cf","name":"Test Private Waypoint","topic":"","payload":"{\"_type\": \"location\", \"lat\": \"xxxx\", \"lon\": \"yyyy\", \"tst\": \"1391715492\", \"acc\": \"500.0\", \"batt\": \"48\", \"event\": \"enter\"}","payloadType":"string","repeat":"","crontab":"","once":false,"x":215,"y":990,"wires":[["3627dd79.9a4072"]]},{"id":"eaa1acff.7e5f4","type":"http request","z":"b7b775e0.9589b8","name":"time clocks","method":"GET","ret":"obj","url":"https://www.humanity.com/api/v2/timeclocks?start_date={{{start_date}}}&employee={{{payload.humanityid}}}&access_token={{{token}}}","tls":"","x":590,"y":240,"wires":[["3aeb169d.ac343a"]]},{"id":"44532437.4d6efc","type":"http in","z":"b7b775e0.9589b8","name":"","url":"/employees/timeclocks/","method":"get","upload":false,"swaggerDoc":"","x":188.1944465637207,"y":239.78472232818604,"wires":[["b20be952.a99428"]]},{"id":"b20be952.a99428","type":"function","z":"b7b775e0.9589b8","name":"","func":"\nconsole.log(msg.payload)\nvar start_date = msg.payload.start_date\nmsg.start_date = start_date\n\nmsg.headers = {}\nmsg.token = global.get('humanity').token\nmsg.headers[\"content-type\"] = 'application/x-www-form-urlencoded' //should be set to application/x-www-form-urlencoded.\nmsg.redirect = false\nmsg.payload = global.get(msg.payload.username)\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":240,"wires":[["eaa1acff.7e5f4"]]},{"id":"bcdc20a8.2cd35","type":"http response","z":"b7b775e0.9589b8","name":"","statusCode":"","headers":{},"x":930,"y":240,"wires":[]},{"id":"3aeb169d.ac343a","type":"change","z":"b7b775e0.9589b8","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"application/json","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":240,"wires":[["bcdc20a8.2cd35"]]},{"id":"17a92fcc.3de4e","type":"http request","z":"b7b775e0.9589b8","name":"time clocks","method":"GET","ret":"obj","url":"http://www.humanity.com/api/v2/timeclocks/status/{{{payload.humanityid}}}/0?access_token={{{token}}}","tls":"","x":590,"y":280,"wires":[["14db9de7.dc1802"]]},{"id":"274d8e69.700032","type":"http in","z":"b7b775e0.9589b8","name":"","url":"/employees/clockstatus","method":"get","upload":false,"swaggerDoc":"","x":185,"y":285.7673578262329,"wires":[["a5766f38.f6681"]]},{"id":"a5766f38.f6681","type":"function","z":"b7b775e0.9589b8","name":"","func":"msg.headers = {}\nmsg.token = global.get('humanity').token\nmsg.headers[\"content-type\"] = 'application/x-www-form-urlencoded' //should be set to application/x-www-form-urlencoded.\nmsg.redirect = false\nmsg.payload = global.get( msg.payload.username)\nvar username = msg.payload.username\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":280,"wires":[["17a92fcc.3de4e"]]},{"id":"925f121a.70f56","type":"http response","z":"b7b775e0.9589b8","name":"","statusCode":"","headers":{},"x":930,"y":280,"wires":[]},{"id":"14db9de7.dc1802","type":"change","z":"b7b775e0.9589b8","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"application/json","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":280,"wires":[["925f121a.70f56"]]},{"id":"b1dbbbe4.b30ab8","type":"http request","z":"b7b775e0.9589b8","name":"clock in","method":"POST","ret":"obj","url":"https://www.humanity.com/api/v2/employees/{{{id}}}/clockin?access_token={{{token}}}","tls":"","x":880,"y":360,"wires":[["5f351aa5.5b7a14"]]},{"id":"b469ec11.76db7","type":"http in","z":"b7b775e0.9589b8","name":"","url":"/employees/clock","method":"get","upload":false,"swaggerDoc":"","x":140,"y":380,"wires":[["5abed814.929f78"]]},{"id":"5f351aa5.5b7a14","type":"http response","z":"b7b775e0.9589b8","name":"","statusCode":"","headers":{},"x":1050,"y":360,"wires":[]},{"id":"6373b207.0376bc","type":"http in","z":"b7b775e0.9589b8","name":"","url":"/employees/login","method":"post","upload":false,"swaggerDoc":"","x":160,"y":160,"wires":[["709c529e.a5400c","3cd14f63.881bd"]]},{"id":"709c529e.a5400c","type":"function","z":"b7b775e0.9589b8","name":"","func":"var username = msg.payload.username\nmsg.payload = {\n    key: \"userId\",\n    reservedKey: \"username\",\n    value: username,\n    operator: \"=\"\n}\n\nreturn msg","outputs":1,"noerr":0,"x":350,"y":160,"wires":[[]]},{"id":"3cd14f63.881bd","type":"http response","z":"b7b775e0.9589b8","name":"","statusCode":"200","headers":{},"x":860,"y":120,"wires":[]},{"id":"913488d.e300278","type":"function","z":"b7b775e0.9589b8","name":"","func":"\nglobal.set(msg.payload.Items[0].username, msg.payload.Items[0])\nconsole.log(global.get(msg.payload.Items[0].username))\nmsg.topic = \"\"\nconsole.log(global.get('ash2'))\nreturn msg;\n","outputs":1,"noerr":0,"x":710,"y":160,"wires":[["3cd14f63.881bd"]]},{"id":"6297f0a7.0541","type":"inject","z":"b7b775e0.9589b8","name":"Humanity Startup","topic":"ash2","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":171.00690078735352,"y":626.9097957611084,"wires":[["768ff2b2.6eaf2c"]]},{"id":"d35b3af6.eca1d8","type":"http request","z":"b7b775e0.9589b8","name":"employees","method":"GET","ret":"obj","url":"https://www.humanity.com/api/v2/companies/135324?access_token={{{token}}}","tls":"","x":510,"y":640,"wires":[[]]},{"id":"768ff2b2.6eaf2c","type":"function","z":"b7b775e0.9589b8","name":"ash2","func":"msg.headers = {}\nmsg.headers[\"content-type\"] = 'application/x-www-form-urlencoded' //should be set to application/x-www-form-urlencoded.\nmsg.redirect = false\nmsg.token =  global.get('humanity').token\nconsole.log(msg)\nreturn msg;","outputs":1,"noerr":0,"x":330.65618896484375,"y":630.5660095214844,"wires":[["d35b3af6.eca1d8"]]},{"id":"6d196626.5ed558","type":"http request","z":"b7b775e0.9589b8","name":"clock out","method":"PUT","ret":"obj","url":"https://www.humanity.com/api/v2/employees/4041624/clockout?access_token={{{token}}}","tls":"","x":540,"y":460,"wires":[["4e2f68ad.97d648"]]},{"id":"b808d774.42add8","type":"http in","z":"b7b775e0.9589b8","name":"","url":"/employees/clockout","method":"put","upload":false,"swaggerDoc":"","x":140,"y":453.75694274902344,"wires":[["a12b026c.e148a"]]},{"id":"a12b026c.e148a","type":"function","z":"b7b775e0.9589b8","name":"","func":"// msg.headers = {}\nmsg.token = global.get('humanity').token\n// msg.headers[\"content-type\"] = 'application/x-www-form-urlencoded' //should be set to application/x-www-form-urlencoded.\nmsg.redirect = false\nconsole.log(msg.payload.username)\nmsg.payload = global.get( msg.payload.username)\nvar username = msg.payload.username\nreturn msg;\n\n// msg.headers = {}\n\n// msg.headers[\"content-type\"] = 'application/x-www-form-urlencoded' //should be set to application/x-www-form-urlencoded.\n// msg.redirect = false\n// msg.token =  global.get('humanity').token\n// // msg.id = msg.payload.id\n// console.log(msg.payload.id)\n// var username = msg.payload.username\n// console.log(username)\n// msg.payload = {\n//     key: \"userId\",\n//     reservedKey: \"username\",\n//     value: username,\n//     operator: \"=\"\n// }\n\n// return msg;","outputs":1,"noerr":0,"x":370,"y":460,"wires":[["6d196626.5ed558"]]},{"id":"4e2f68ad.97d648","type":"http response","z":"b7b775e0.9589b8","name":"","statusCode":"200","headers":{},"x":720,"y":460,"wires":[]},{"id":"b81106a2.c3cff8","type":"http request","z":"b7b775e0.9589b8","name":"time clocks","method":"GET","ret":"obj","url":"http://www.humanity.com/api/v2/timeclocks/status/{{{payload.humanityid}}}/0?access_token={{{token}}}","tls":"","x":530,"y":380,"wires":[["bf034636.95b0b8"]]},{"id":"5abed814.929f78","type":"function","z":"b7b775e0.9589b8","name":"","func":"msg.headers = {}\nmsg.token = global.get('humanity').token\nmsg.headers[\"content-type\"] = 'application/x-www-form-urlencoded' //should be set to application/x-www-form-urlencoded.\nmsg.redirect = false\nmsg.uname = msg.payload.username\nmsg.payload = global.get( msg.payload.username)\nmsg.id = global.get( msg.payload.username).humanityid\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":380,"wires":[["b81106a2.c3cff8"]]},{"id":"bf034636.95b0b8","type":"switch","z":"b7b775e0.9589b8","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"eq","v":"out","vt":"str"},{"t":"eq","v":"in","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":380,"wires":[["b1dbbbe4.b30ab8"],["14cbbb9.6ec3144"]]},{"id":"14cbbb9.6ec3144","type":"http request","z":"b7b775e0.9589b8","name":"clock out","method":"PUT","ret":"obj","url":"https://www.humanity.com/api/v2/employees/{{{payload.humanityid}}}/clockout?access_token={{{token}}}","tls":"","x":880,"y":400,"wires":[["68bfb194.51673"]]},{"id":"68bfb194.51673","type":"http response","z":"b7b775e0.9589b8","name":"","statusCode":"","headers":{},"x":1050,"y":400,"wires":[]},{"id":"3803f0a5.464b5","type":"http in","z":"b7b775e0.9589b8","name":"","url":"/api/putprofiles","method":"get","upload":false,"swaggerDoc":"","x":1230,"y":120,"wires":[["f10c377c.023a88","1c692060.5bf0b"]]},{"id":"1c692060.5bf0b","type":"http response","z":"b7b775e0.9589b8","name":"profiles inserted","statusCode":"","headers":{},"x":1720,"y":120,"wires":[]},{"id":"889bd60c.2ed098","type":"http in","z":"b7b775e0.9589b8","name":"","url":"/api/getprofiles","method":"get","upload":false,"swaggerDoc":"","x":1230,"y":180,"wires":[["30f18643.e8411a"]]},{"id":"70ead7f9.ddaf18","type":"http response","z":"b7b775e0.9589b8","name":"return profiles","statusCode":"","headers":{},"x":1720,"y":180,"wires":[]},{"id":"a071c688.46eae8","type":"inject","z":"b7b775e0.9589b8","name":"insert profile","topic":"profiles","payload":"{\"username\":\"ash2\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1250,"y":80,"wires":[["f10c377c.023a88"]]},{"id":"f10c377c.023a88","type":"cloudantplus out","z":"b7b775e0.9589b8","name":"insert profiles","cloudant":"351736bb.017b9a","database":"profiles","service":"_ext_","payonly":true,"operation":"insert","x":1450,"y":100,"wires":[]},{"id":"30f18643.e8411a","type":"cloudantplus in","z":"b7b775e0.9589b8","name":"Retrieve profiles","cloudant":"351736bb.017b9a","database":"profiles","service":"_ext_","search":"_id_","design":"","index":"","x":1460,"y":180,"wires":[["70ead7f9.ddaf18"]]},{"id":"d16eaba5.182198","type":"http in","z":"b7b775e0.9589b8","name":"","url":"/api/employees/login","method":"post","upload":false,"swaggerDoc":"","x":1370,"y":320,"wires":[["b679f57.dbaf608","1e15c9f0.889cc6"]]},{"id":"90b9ade4.2d05c","type":"function","z":"b7b775e0.9589b8","name":"","func":"// var username = msg.payload.username\n// // msg.payload = {\n// //     key: \"userId\",\n// //     reservedKey: \"username\",\n// //     value: username,\n// //     operator: \"=\"\n// // }\n\n// return msgurn msg;","outputs":1,"noerr":0,"x":1450,"y":400,"wires":[[]]},{"id":"83bec5ac.0e8338","type":"function","z":"b7b775e0.9589b8","name":"ashdowning@gmail.com","func":"\nfor(var profile in msg.payload){\n    if(profile.username == msg.payload.username){\n        // global.set(profile.username, msg.payload[0])\n        return msg\n    }\n}\nmsg.payload = '404'\nreturn msg","outputs":1,"noerr":0,"x":1930,"y":280,"wires":[[]]},{"id":"4cc306b0.eb7c38","type":"http response","z":"b7b775e0.9589b8","name":"","statusCode":"","headers":{},"x":1870,"y":320,"wires":[]},{"id":"8cf2782.b1efc88","type":"inject","z":"b7b775e0.9589b8","name":"","topic":"","payload":"{\"username\" :\"ash2\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1370,"y":280,"wires":[[]]},{"id":"b679f57.dbaf608","type":"debug","z":"b7b775e0.9589b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1890,"y":360,"wires":[]},{"id":"1e15c9f0.889cc6","type":"cloudantplus in","z":"b7b775e0.9589b8","name":"","cloudant":"351736bb.017b9a","database":"profiles","service":"_ext_","search":"_id_","design":"","index":"","x":1620,"y":320,"wires":[["b679f57.dbaf608","4cc306b0.eb7c38","83bec5ac.0e8338"]]},{"id":"b0026d66.0a06b","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/api/getprofiles","method":"get","upload":false,"swaggerDoc":"","x":150,"y":620,"wires":[["12353ee6.dfaf91"]]},{"id":"324e8e84.fd0f52","type":"http response","z":"3c1f6dd2.c28162","name":"return profiles","statusCode":"","headers":{},"x":640,"y":620,"wires":[]},{"id":"a27dd8c3.f2bc78","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/api/putconsumables","method":"get","upload":false,"swaggerDoc":"","x":170,"y":800,"wires":[["511cdca1.7782e4","22e331a7.bea31e"]]},{"id":"22e331a7.bea31e","type":"http response","z":"3c1f6dd2.c28162","name":"consumables inserted","statusCode":"","headers":{},"x":660,"y":800,"wires":[]},{"id":"fdd2210e.eb679","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/api/getconsumables","method":"get","upload":false,"swaggerDoc":"","x":160,"y":860,"wires":[["8d7d7257.b3b39"]]},{"id":"afc23077.7458a","type":"http response","z":"3c1f6dd2.c28162","name":"return consumables","statusCode":"","headers":{},"x":640,"y":860,"wires":[]},{"id":"9c952ff6.37e0a","type":"http response","z":"3c1f6dd2.c28162","name":"owntracks inserted","statusCode":"","headers":{},"x":690,"y":1460,"wires":[]},{"id":"39d5376b.4128e8","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/api/assets/checkouthardware","method":"get","upload":false,"swaggerDoc":"","x":1030,"y":660,"wires":[["f5a3e905.1759e8"]]},{"id":"b1cf69ec.9e58a8","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/api/assets/checkinhardware","method":"get","upload":false,"swaggerDoc":"","x":980,"y":720,"wires":[["2bdba136.4ce61e"]]},{"id":"f5a3e905.1759e8","type":"function","z":"3c1f6dd2.c28162","name":"ash","func":"msg.headers = {}\nvar msg2 = msg \nconst token = global.get('snipeit_token')\nmsg.headers['Accept'] = 'application/json'\nmsg.headers[\"Authorization\"] = 'Bearer '+ token\nmsg.redirect = false\nmsg.assetId = msg.payload.assetId\nmsg.username = msg.payload.username\nnode.warn(msg.username)\nmsg.snipeit_host = global.get('snipeit_host')\nmsg2 = msg.payload = global.get('profiles')\n\nreturn [msg, msg2]","outputs":1,"noerr":0,"x":1230,"y":660,"wires":[["8ffa95cd.5beb58"]]},{"id":"ba3d30f4.5961a","type":"http response","z":"3c1f6dd2.c28162","name":"","statusCode":"","headers":{},"x":1790,"y":660,"wires":[]},{"id":"2bdba136.4ce61e","type":"function","z":"3c1f6dd2.c28162","name":"ash","func":"msg.headers = {}\nconst token = global.get('snipeit_token')\nmsg.headers['Accept'] = 'application/json'\nmsg.headers[\"Authorization\"] = 'Bearer '+ token\nmsg.redirect = false\nconsole.log(msg.payload.assetId)\nmsg.id = msg.payload.assetId\nmsg.snipeit_host = global.get('snipeit_host')\n\n console.log(msg.id)\nreturn msg;","outputs":1,"noerr":0,"x":1180,"y":720,"wires":[["e07c4f3b.689cf"]]},{"id":"8842d210.9b036","type":"http request","z":"3c1f6dd2.c28162","name":"","method":"GET","ret":"txt","url":"{{{snipeit_host}}}/hardware/{{{assetId}}}/checkout?assigned_user={{{userId}}}&checkout_to_type=user","tls":"","x":1630,"y":660,"wires":[["ba3d30f4.5961a","bbf2adb6.f5aee","74bb41c4.f14e6"]]},{"id":"5173a3f0.d201bc","type":"function","z":"3c1f6dd2.c28162","name":"ash","func":"msg.headers = {}\nconst token = global.get('snipeit_token')\nmsg.headers['Accept'] = 'application/json'\nmsg.headers[\"Authorization\"] = 'Bearer '+ token\nmsg.redirect = false\nmsg.snipeit_host = global.get('snipeit_host')\nmsg.mock = false\nreturn msg;","outputs":1,"noerr":0,"x":1190,"y":800,"wires":[["9fc98215.0c0ee"]]},{"id":"9fc98215.0c0ee","type":"http request","z":"3c1f6dd2.c28162","name":"","method":"GET","ret":"txt","url":"{{{snipeit_host}}}/hardware","tls":"","x":1330,"y":800,"wires":[["6cfe6b52.86d654"]]},{"id":"e29b26.882f34d8","type":"function","z":"3c1f6dd2.c28162","name":"set snipeit shit","func":"global.set('snipeit_token', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjQ0ODQ5ZmVjYmQ3YTBiNWUxMjg4MzUzMjZkZjdkNDM0ZjA1YjVmNWVmZjM0MWQ3NTVjM2NmMGVhODIxODNjNjAyNWQ4NWE4OTE2ZWNiMjlmIn0.eyJhdWQiOiIxIiwianRpIjoiNDQ4NDlmZWNiZDdhMGI1ZTEyODgzNTMyNmRmN2Q0MzRmMDViNWY1ZWZmMzQxZDc1NWMzY2YwZWE4MjE4M2M2MDI1ZDg1YTg5MTZlY2IyOWYiLCJpYXQiOjE1MjgzMDkyMDgsIm5iZiI6MTUyODMwOTIwOCwiZXhwIjoxNTU5ODQ1MjA4LCJzdWIiOiIxIiwic2NvcGVzIjpbXX0.yv1QL0Vbf4EupDdI-9U6somSbALryrk5UXX5cMV_iNILSye7rKqruoLurDghzt6-2PboAHffoiWnBGRp36vdJ5oUTNKWPSYl-PQqLkDVWjinpcQ0jHZM75lLausxkIknDi4bFlXPgWHtewotLUQKdDW-Nkij6EckVUZbn2lOFw2bi2HOGzENVl7H8VHaBXlQw_cBpT7w4K1FaHkYE2qECK-B2GZ0VlVw3sBDESbyT0sb-HRzt-6R1icItzMHUXz0sbJox3LyfGJ3X4Z3-_tKk3mxd9TXldWf7HTdk5d65r9YBCl770Ha1rAKhwyGGvMU6jBfQemGcklzooivRfVjzhRD5BlpJNqus7NquyEYacPdmm7A4Tp3bbzyxNeh_7jlVjqsf7CrWy78nFUdrrtE6gBavMwAz8AE7FScH6NzMjCekTU-pvEuUjEmTwj5p_NCUt8Yjwo9u66UzlgVf45wsG3qngL50D097rTzdA97-XGlt-csbZ_m7v2lJXNjR0yxM29aNFQBnui7RLd0_mAtoP41WtXMNlsLL9uaD3wK2tpcpoZViRWPYeg9gs81goMTzQ0ct370urdwkuNwNMvX5N1yljJIShgXnk75EP6YscOdmvR5FrlLm_5b07k7Ywwd9ZfbuaT9RI6YeUruSlH6-fGeH3Q37Gui1i4QSU5M5uc')\nglobal.set('snipeit_host', 'http://52.39.121.124:8080/api/v1')\n\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1260,"y":880,"wires":[["d8b6a9d7.601368"]]},{"id":"407dd24e.a6565c","type":"function","z":"3c1f6dd2.c28162","name":"ash","func":"global.set('profiles', JSON.parse(msg.payload))\n\nreturn msg;","outputs":1,"noerr":0,"x":1650,"y":880,"wires":[[]]},{"id":"d8b6a9d7.601368","type":"http request","z":"3c1f6dd2.c28162","name":"","method":"GET","ret":"txt","url":"https://opol.mybluemix.net/getdata","tls":"","x":1490,"y":880,"wires":[["407dd24e.a6565c"]]},{"id":"9af28003.0e33f","type":"inject","z":"3c1f6dd2.c28162","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":1070,"y":880,"wires":[["e29b26.882f34d8"]]},{"id":"6cfe6b52.86d654","type":"http response","z":"3c1f6dd2.c28162","name":"","statusCode":"","headers":{},"x":1490,"y":800,"wires":[]},{"id":"a63cb5e5.0496d8","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/api/assets/hardwarelist","method":"get","upload":false,"swaggerDoc":"","x":1000,"y":800,"wires":[["5173a3f0.d201bc"]]},{"id":"e07c4f3b.689cf","type":"http request","z":"3c1f6dd2.c28162","name":"","method":"GET","ret":"txt","url":"{{{snipeit_host}}}/hardware/{{{id}}}/checkin","tls":"","x":1330,"y":720,"wires":[["8688016f.3e594"]]},{"id":"8688016f.3e594","type":"http response","z":"3c1f6dd2.c28162","name":"","statusCode":"","headers":{},"x":1490,"y":720,"wires":[]},{"id":"fc93015e.73583","type":"function","z":"3c1f6dd2.c28162","name":"","func":"// msg.assetId = msg.payload[0].assetId\n// msg.userId = msg.payload.userId\nmsg.userId = msg.payload.snipeitId\nnode.warn(msg.userId)\n\nreturn msg;","outputs":1,"noerr":0,"x":1490,"y":660,"wires":[["8842d210.9b036"]]},{"id":"8ffa95cd.5beb58","type":"filter","z":"3c1f6dd2.c28162","name":"","property":"msg2.payload.username","propertyType":"flow","asArray":false,"itemProperty":"payload","itemPropertyType":"item","rules":[{"t":"eq","v":"msg2.username","vt":"flow","output":1}],"checkall":"true","outputs":1,"x":1370,"y":660,"wires":[["fc93015e.73583"]]},{"id":"74bb41c4.f14e6","type":"debug","z":"3c1f6dd2.c28162","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1810,"y":720,"wires":[]},{"id":"61b6712e.f9824","type":"function","z":"3c1f6dd2.c28162","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1790,"y":600,"wires":[[]]},{"id":"ecc5dbfe.d8de18","type":"inject","z":"3c1f6dd2.c28162","name":"","topic":"","payload":"{\"assetId\":\"1\", \"username\":\"ash\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1090,"y":620,"wires":[["f5a3e905.1759e8"]]},{"id":"d5a74848.a33ce8","type":"debug","z":"3c1f6dd2.c28162","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":320,"y":1460,"wires":[]},{"id":"ad27fd78.d4898","type":"ibmiot in","z":"3c1f6dd2.c28162","authentication":"apiKey","apiKey":"4628ab5c.abe6c4","inputType":"evt","logicalInterface":"","ruleId":"","deviceId":"","applicationId":"","deviceType":"+Tablets","eventType":"+","commandType":"","format":"json","name":"IBM IoT","service":"registered","allDevices":"","allApplications":"","allDeviceTypes":"","allLogicalInterfaces":"","allEvents":"","allCommands":"","allFormats":"","qos":0,"x":150,"y":1460,"wires":[["d5a74848.a33ce8","75e7658c.26cf7c"]]},{"id":"bbf2adb6.f5aee","type":"DataIn","z":"3c1f6dd2.c28162","collection":"8c5fc8f9.567368","name":"checkoutlist","update":false,"path":"/assets/checkoutlist","x":1930,"y":620,"wires":[]},{"id":"988bbcc5.dc164","type":"DataOut","z":"3c1f6dd2.c28162","collection":"8c5fc8f9.567368","name":"ashdowning@gmail.com","path":"/","error":false,"x":1530,"y":560,"wires":[[]]},{"id":"511cdca1.7782e4","type":"cloudantplus out","z":"3c1f6dd2.c28162","name":"insert consumables","cloudant":"351736bb.017b9a","database":"consumables","service":"_ext_","payonly":true,"operation":"insert","x":390,"y":780,"wires":[]},{"id":"75e7658c.26cf7c","type":"cloudantplus out","z":"3c1f6dd2.c28162","name":"insert owntracks","cloudant":"351736bb.017b9a","database":"owntracks","service":"_ext_","payonly":true,"operation":"insert","x":320,"y":1420,"wires":[]},{"id":"12353ee6.dfaf91","type":"cloudantplus in","z":"3c1f6dd2.c28162","name":"Retrieve profiles","cloudant":"351736bb.017b9a","database":"profiles","service":"_ext_","search":"_id_","design":"","index":"","x":380,"y":620,"wires":[["324e8e84.fd0f52"]]},{"id":"8d7d7257.b3b39","type":"cloudantplus in","z":"3c1f6dd2.c28162","name":"Retrieve consumables","cloudant":"351736bb.017b9a","database":"consumables","service":"_ext_","search":"_id_","design":"","index":"","x":390,"y":860,"wires":[["afc23077.7458a"]]},{"id":"a26a07b0.7be7e8","type":"http response","z":"3c1f6dd2.c28162","name":"owntracks inserted","statusCode":"","headers":{},"x":670,"y":1300,"wires":[]},{"id":"84db2aa1.330318","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/api/getowntracks","method":"get","upload":false,"swaggerDoc":"","x":180,"y":1360,"wires":[["cc739775.f94fd8"]]},{"id":"d334ec17.7ef2e","type":"http response","z":"3c1f6dd2.c28162","name":"return owntracks","statusCode":"","headers":{},"x":660,"y":1360,"wires":[]},{"id":"670b5290.2f0e5c","type":"cloudantplus out","z":"3c1f6dd2.c28162","name":"insert owntracks","cloudant":"351736bb.017b9a","database":"owntracks","service":"Opol6-cloudantNoSQLDB","payonly":true,"operation":"insert","x":420,"y":1300,"wires":[]},{"id":"cc739775.f94fd8","type":"cloudantplus in","z":"3c1f6dd2.c28162","name":"Retrieve owntracks","cloudant":"351736bb.017b9a","database":"owntracks","service":"Opol6-cloudantNoSQLDB","search":"_id_","design":"","index":"","x":410,"y":1360,"wires":[["d334ec17.7ef2e"]]},{"id":"ee67e2f4.1f1e2","type":"debug","z":"3c1f6dd2.c28162","name":"","active":false,"complete":false,"x":550,"y":1460,"wires":[]},{"id":"6227617a.3241e","type":"function","z":"3c1f6dd2.c28162","name":"ash2","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\nvar now = Date();\nvar message = \"\";\ndata = JSON.parse(msg.payload);\n\nif ( (data._type == \"location\") && (data.event != undefined ) ) {\n\t\n\t\tif ( data.event == \"enter\" ) {\t\t\t\n\t\t\tmessage = \"Entering Location: \";\n\t\t} else {\n\t\t\tmessage = \"Leaving Location: \";\n\t\t}\n\t\t\n\t\tif ( data.desc != undefined ) {\n\t\t\t// Shared waypoint, comes with a description:\n\t\t\t\tmessage += data.desc;\n \t\t} else {\n \t\t\t// No description is set, non shared \"private\" waypoint\n \t\t\t\tmessage += data.lat + \",\" + data.lon;\n \t\t}\n }\n\nmsg.payload = message;\n//console.log(msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":391,"y":1585,"wires":[["9e840699.900e58","efa2dc99.4fe36"]]},{"id":"9e840699.900e58","type":"switch","z":"3c1f6dd2.c28162","name":"","property":"payload","rules":[{"t":"cont","v":"Location"}],"checkall":"true","outputs":1,"x":552,"y":1585,"wires":[[]]},{"id":"efa2dc99.4fe36","type":"debug","z":"3c1f6dd2.c28162","name":"","active":true,"complete":false,"x":551,"y":1513,"wires":[]},{"id":"2e43b443.47db1c","type":"inject","z":"3c1f6dd2.c28162","name":"Test Shared Waypoint","topic":"","payload":"{\"_type\": \"location\", \"lat\": \"xxxx\", \"lon\": \"yyyy\", \"tst\": \"1391715492\", \"acc\": \"500.0\", \"batt\": \"48\", \"desc\": \"Shared Test Waypoint\", \"event\": \"enter\"}","payloadType":"string","repeat":"","crontab":"","once":false,"x":196,"y":1585,"wires":[["6227617a.3241e"]]},{"id":"39ace3f7.f3694c","type":"inject","z":"3c1f6dd2.c28162","name":"Test Private Waypoint","topic":"","payload":"{\"_type\": \"location\", \"lat\": \"xxxx\", \"lon\": \"yyyy\", \"tst\": \"1391715492\", \"acc\": \"500.0\", \"batt\": \"48\", \"event\": \"enter\"}","payloadType":"string","repeat":"","crontab":"","once":false,"x":195,"y":1650,"wires":[["6227617a.3241e"]]},{"id":"c27aa18.5d9c76","type":"http request","z":"3c1f6dd2.c28162","name":"time clocks","method":"GET","ret":"obj","url":"https://www.humanity.com/api/v2/timeclocks?start_date={{{start_date}}}&employee={{{payload.humanityid}}}&access_token={{{token}}}","tls":"","x":550,"y":1940,"wires":[["da1022b0.15b54"]]},{"id":"949b866f.707c38","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/employees/timeclocks/","method":"get","upload":false,"swaggerDoc":"","x":148.1944465637207,"y":1939.784722328186,"wires":[["1fcda31b.47060d"]]},{"id":"1fcda31b.47060d","type":"function","z":"3c1f6dd2.c28162","name":"","func":"\nconsole.log(msg.payload)\nvar start_date = msg.payload.start_date\nmsg.start_date = start_date\n\nmsg.headers = {}\nmsg.token = global.get('humanity').token\nmsg.headers[\"content-type\"] = 'application/x-www-form-urlencoded' //should be set to application/x-www-form-urlencoded.\nmsg.redirect = false\nmsg.payload = global.get(msg.payload.username)\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":1940,"wires":[["c27aa18.5d9c76"]]},{"id":"6767cfed.1020b","type":"http response","z":"3c1f6dd2.c28162","name":"","statusCode":"","headers":{},"x":890,"y":1940,"wires":[]},{"id":"da1022b0.15b54","type":"change","z":"3c1f6dd2.c28162","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"application/json","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":1940,"wires":[["6767cfed.1020b"]]},{"id":"c219241f.189278","type":"http request","z":"3c1f6dd2.c28162","name":"time clocks","method":"GET","ret":"obj","url":"http://www.humanity.com/api/v2/timeclocks/status/{{{payload.humanityid}}}/0?access_token={{{token}}}","tls":"","x":550,"y":1980,"wires":[["f4d34877.72d2b8"]]},{"id":"881e68c7.d8dcb8","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/employees/clockstatus","method":"get","upload":false,"swaggerDoc":"","x":145,"y":1985.767357826233,"wires":[["da9cc61e.2c0348"]]},{"id":"da9cc61e.2c0348","type":"function","z":"3c1f6dd2.c28162","name":"","func":"msg.headers = {}\nmsg.token = global.get('humanity').token\nmsg.headers[\"content-type\"] = 'application/x-www-form-urlencoded' //should be set to application/x-www-form-urlencoded.\nmsg.redirect = false\nmsg.payload = global.get( msg.payload.username)\nvar username = msg.payload.username\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":1980,"wires":[["c219241f.189278"]]},{"id":"1b370dcd.eda5e2","type":"http response","z":"3c1f6dd2.c28162","name":"","statusCode":"","headers":{},"x":890,"y":1980,"wires":[]},{"id":"f4d34877.72d2b8","type":"change","z":"3c1f6dd2.c28162","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"application/json","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":1980,"wires":[["1b370dcd.eda5e2"]]},{"id":"675e86d2.f6c2f8","type":"http request","z":"3c1f6dd2.c28162","name":"clock in","method":"POST","ret":"obj","url":"https://www.humanity.com/api/v2/employees/{{{id}}}/clockin?access_token={{{token}}}","tls":"","x":840,"y":2060,"wires":[["f74f38d5.a29468"]]},{"id":"d815c2d0.4272b","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/employees/clock","method":"get","upload":false,"swaggerDoc":"","x":100,"y":2080,"wires":[["d937041b.64e2a8"]]},{"id":"f74f38d5.a29468","type":"http response","z":"3c1f6dd2.c28162","name":"","statusCode":"","headers":{},"x":1010,"y":2060,"wires":[]},{"id":"d947418.e011fc","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/employees/login","method":"post","upload":false,"swaggerDoc":"","x":120,"y":1860,"wires":[["b6363ace.bff228","e5564e92.28488"]]},{"id":"b6363ace.bff228","type":"function","z":"3c1f6dd2.c28162","name":"","func":"var username = msg.payload.username\nmsg.payload = {\n    key: \"userId\",\n    reservedKey: \"username\",\n    value: username,\n    operator: \"=\"\n}\n\nreturn msg","outputs":1,"noerr":0,"x":310,"y":1860,"wires":[[]]},{"id":"e5564e92.28488","type":"http response","z":"3c1f6dd2.c28162","name":"","statusCode":"200","headers":{},"x":820,"y":1820,"wires":[]},{"id":"142029b6.80ba16","type":"function","z":"3c1f6dd2.c28162","name":"","func":"\nglobal.set(msg.payload.Items[0].username, msg.payload.Items[0])\nconsole.log(global.get(msg.payload.Items[0].username))\nmsg.topic = \"\"\nconsole.log(global.get('ash2'))\nreturn msg;\n","outputs":1,"noerr":0,"x":670,"y":1860,"wires":[["e5564e92.28488"]]},{"id":"52d7323b.2b47cc","type":"inject","z":"3c1f6dd2.c28162","name":"Humanity Startup","topic":"ash2","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":131.00690078735352,"y":2326.9097957611084,"wires":[["436bde48.b3e15"]]},{"id":"be18ecfe.e8a61","type":"http request","z":"3c1f6dd2.c28162","name":"employees","method":"GET","ret":"obj","url":"https://www.humanity.com/api/v2/companies/135324?access_token={{{token}}}","tls":"","x":470,"y":2340,"wires":[[]]},{"id":"436bde48.b3e15","type":"function","z":"3c1f6dd2.c28162","name":"ash2","func":"msg.headers = {}\nmsg.headers[\"content-type\"] = 'application/x-www-form-urlencoded' //should be set to application/x-www-form-urlencoded.\nmsg.redirect = false\nmsg.token =  global.get('humanity').token\nconsole.log(msg)\nreturn msg;","outputs":1,"noerr":0,"x":290.65618896484375,"y":2330.5660095214844,"wires":[["be18ecfe.e8a61"]]},{"id":"8ba0eec9.1ca6e","type":"http request","z":"3c1f6dd2.c28162","name":"clock out","method":"PUT","ret":"obj","url":"https://www.humanity.com/api/v2/employees/4041624/clockout?access_token={{{token}}}","tls":"","x":500,"y":2160,"wires":[["fc3dedb9.8e6c8"]]},{"id":"54a5a428.07d71c","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/employees/clockout","method":"put","upload":false,"swaggerDoc":"","x":100,"y":2153.7569427490234,"wires":[["cf5a461d.007e48"]]},{"id":"cf5a461d.007e48","type":"function","z":"3c1f6dd2.c28162","name":"","func":"// msg.headers = {}\nmsg.token = global.get('humanity').token\n// msg.headers[\"content-type\"] = 'application/x-www-form-urlencoded' //should be set to application/x-www-form-urlencoded.\nmsg.redirect = false\nconsole.log(msg.payload.username)\nmsg.payload = global.get( msg.payload.username)\nvar username = msg.payload.username\nreturn msg;\n\n// msg.headers = {}\n\n// msg.headers[\"content-type\"] = 'application/x-www-form-urlencoded' //should be set to application/x-www-form-urlencoded.\n// msg.redirect = false\n// msg.token =  global.get('humanity').token\n// // msg.id = msg.payload.id\n// console.log(msg.payload.id)\n// var username = msg.payload.username\n// console.log(username)\n// msg.payload = {\n//     key: \"userId\",\n//     reservedKey: \"username\",\n//     value: username,\n//     operator: \"=\"\n// }\n\n// return msg;","outputs":1,"noerr":0,"x":330,"y":2160,"wires":[["8ba0eec9.1ca6e"]]},{"id":"fc3dedb9.8e6c8","type":"http response","z":"3c1f6dd2.c28162","name":"","statusCode":"200","headers":{},"x":680,"y":2160,"wires":[]},{"id":"c6d5c0cd.2fdd5","type":"http request","z":"3c1f6dd2.c28162","name":"time clocks","method":"GET","ret":"obj","url":"http://www.humanity.com/api/v2/timeclocks/status/{{{payload.humanityid}}}/0?access_token={{{token}}}","tls":"","x":490,"y":2080,"wires":[["c491da6d.ec6e58"]]},{"id":"d937041b.64e2a8","type":"function","z":"3c1f6dd2.c28162","name":"","func":"msg.headers = {}\nmsg.token = global.get('humanity').token\nmsg.headers[\"content-type\"] = 'application/x-www-form-urlencoded' //should be set to application/x-www-form-urlencoded.\nmsg.redirect = false\nmsg.uname = msg.payload.username\nmsg.payload = global.get( msg.payload.username)\nmsg.id = global.get( msg.payload.username).humanityid\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":2080,"wires":[["c6d5c0cd.2fdd5"]]},{"id":"c491da6d.ec6e58","type":"switch","z":"3c1f6dd2.c28162","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"eq","v":"out","vt":"str"},{"t":"eq","v":"in","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":2080,"wires":[["675e86d2.f6c2f8"],["547cbad2.69b1c4"]]},{"id":"547cbad2.69b1c4","type":"http request","z":"3c1f6dd2.c28162","name":"clock out","method":"PUT","ret":"obj","url":"https://www.humanity.com/api/v2/employees/{{{payload.humanityid}}}/clockout?access_token={{{token}}}","tls":"","x":840,"y":2100,"wires":[["446ca778.140e38"]]},{"id":"446ca778.140e38","type":"http response","z":"3c1f6dd2.c28162","name":"","statusCode":"","headers":{},"x":1010,"y":2100,"wires":[]},{"id":"1aa5f85e.115ef8","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/api/putprofiles","method":"get","upload":false,"swaggerDoc":"","x":1190,"y":1820,"wires":[["364951c5.6a194e","a56fa6dc.c19668"]]},{"id":"a56fa6dc.c19668","type":"http response","z":"3c1f6dd2.c28162","name":"profiles inserted","statusCode":"","headers":{},"x":1680,"y":1820,"wires":[]},{"id":"948b5058.c96c3","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/api/getprofiles","method":"get","upload":false,"swaggerDoc":"","x":1190,"y":1880,"wires":[["ea6baae6.170f58"]]},{"id":"ecbff9f0.7de588","type":"http response","z":"3c1f6dd2.c28162","name":"return profiles","statusCode":"","headers":{},"x":1680,"y":1880,"wires":[]},{"id":"c605a6df.57cfa8","type":"inject","z":"3c1f6dd2.c28162","name":"insert profile","topic":"profiles","payload":"{\"username\":\"ash2\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1210,"y":1780,"wires":[["364951c5.6a194e"]]},{"id":"364951c5.6a194e","type":"cloudantplus out","z":"3c1f6dd2.c28162","name":"insert profiles","cloudant":"351736bb.017b9a","database":"profiles","service":"_ext_","payonly":true,"operation":"insert","x":1410,"y":1800,"wires":[]},{"id":"ea6baae6.170f58","type":"cloudantplus in","z":"3c1f6dd2.c28162","name":"Retrieve profiles","cloudant":"351736bb.017b9a","database":"profiles","service":"_ext_","search":"_id_","design":"","index":"","x":1420,"y":1880,"wires":[["ecbff9f0.7de588"]]},{"id":"dfad6456.25e318","type":"http in","z":"3c1f6dd2.c28162","name":"","url":"/api/employees/login","method":"post","upload":false,"swaggerDoc":"","x":1330,"y":2020,"wires":[["513bf974.8c3118","b62cdf05.ddd39"]]},{"id":"9372e541.53b6d8","type":"function","z":"3c1f6dd2.c28162","name":"","func":"// var username = msg.payload.username\n// // msg.payload = {\n// //     key: \"userId\",\n// //     reservedKey: \"username\",\n// //     value: username,\n// //     operator: \"=\"\n// // }\n\n// return msgurn msg;","outputs":1,"noerr":0,"x":1410,"y":2100,"wires":[[]]},{"id":"1c3673cc.f0ea0c","type":"function","z":"3c1f6dd2.c28162","name":"ashdowning@gmail.com","func":"\nfor(var profile in msg.payload){\n    if(profile.username == msg.payload.username){\n        // global.set(profile.username, msg.payload[0])\n        return msg\n    }\n}\nmsg.payload = '404'\nreturn msg","outputs":1,"noerr":0,"x":1890,"y":1980,"wires":[[]]},{"id":"28fdeb3e.4e0244","type":"http response","z":"3c1f6dd2.c28162","name":"","statusCode":"","headers":{},"x":1830,"y":2020,"wires":[]},{"id":"13c0821c.f94c0e","type":"inject","z":"3c1f6dd2.c28162","name":"","topic":"","payload":"{\"username\" :\"ash2\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1330,"y":1980,"wires":[[]]},{"id":"513bf974.8c3118","type":"debug","z":"3c1f6dd2.c28162","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1850,"y":2060,"wires":[]},{"id":"b62cdf05.ddd39","type":"cloudantplus in","z":"3c1f6dd2.c28162","name":"","cloudant":"351736bb.017b9a","database":"profiles","service":"_ext_","search":"_id_","design":"","index":"","x":1580,"y":2020,"wires":[["513bf974.8c3118","28fdeb3e.4e0244","1c3673cc.f0ea0c"]]}]